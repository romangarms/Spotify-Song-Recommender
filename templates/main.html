{% extends "layout.html" %}

{%block title %}
<title>Song Recommender</title>
{%endblock%}

{% block main %}
<div id="outer">
  <div id="left">
    <h1>Song Recommender</h1>
    <h2>Welcome, {{username}}!</h2>
    <p>Choose a playlist to analyze on the right, and generate a new playlist with the "Generate New Playlist" button.</p>
    
    <h2>View your new playlist:</h2>
    <p>{{taste_analysis}}</p>
    <form action="{{new_playlist_url}}">
      <button type="submit">{{new_playlist_name}}</button>
    </form>

    <h2>Generate a new playlist:</h2>
    <p>Click the button below to generate a new playlist based on the selected playlist on the right.</p>
    <form action="/create_playlist" method="post">
      <button type="submit">Generate New Playlist</button>
    </form>


    <h2>Sign Out:</h2>
    <p>Click the button below to sign out of your account.</p>
    <form action="/sign_out">
      <button type="submit">Sign Out</button>
    </form>
  </div>
  <div id="right">
    <h2>Choose a playlist to analyze:</h2>
    <ul id="playlist-list">
      {% for playlist in playlists %}
      <li data-id="{{ playlist.id }}" class="playlist-item{% if playlist.name == playlist_name %} selected{% endif %}">
        {{ playlist.name }}
      </li>
      {% endfor %}
    </ul>
  </div>
</div>


<script>
  document.querySelectorAll('.playlist-item').forEach(item => {
    item.addEventListener('click', () => {
      const playlistId = item.dataset.id;

      fetch('/select_playlist', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ playlist_id: playlistId })
      })
        .then(response => response.json())
        .then(data => {
          console.log('Playlist selected:', data);
          // You can redirect or update the UI here
          location.reload();
        });
    });
  });
</script>

{% endblock %}