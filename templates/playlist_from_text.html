{% extends "layout.html" %}

{%block title %}
<title>Song Recommender</title>
{%endblock%}

{% block left %}
<div>
  <p>Enter text to describe your ideal playlist on the right, and generate a new playlist with the "Generate New
    Playlist" button.
  </p>

  <br>

  <h2>Generate a new playlist:</h2>
  <p>Click the button below to generate a new playlist based on the selected playlist on the right.</p>
  <form action="/generate-from-text" method="post">
    <button type="submit">Generate New Playlist</button>
  </form>

  <br>

  <h2>View your new playlist:</h2>
  <p>{{new_playlist_description}}</p>
  <form action="{{new_playlist_url}}">
    <button type="submit">{{new_playlist_name}}</button>
  </form>

</div>
{% endblock %}

{% block right %}
<div>
  <h2>Enter text to describe your next playlist:</h2>
  <form action="">
    <textarea id="description" placeholder="Describe your playlist..." rows="10" cols="30"></textarea>
  </form>
</div>



{% endblock %}

{% block main %}
<script>
  let typingTimer;
  const doneTypingInterval = 1000; // milliseconds to wait after user stops typing
  const textarea = document.getElementById("description");

  textarea.addEventListener("input", () => {
    clearTimeout(typingTimer);
    typingTimer = setTimeout(sendDescription, doneTypingInterval);
  });

  function sendDescription() {
    const description = textarea.value;

    fetch("/describe_playlist", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ description })
    })
      .then(res => res.json())
      .then(data => {
        console.log("Saved description:", data);
      })
      .catch(err => console.error("Failed to send description", err));
  }
</script>

{% endblock %}