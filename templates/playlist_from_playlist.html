{% extends "layout.html" %}

{%block title %}
<title>Song Recommender</title>
{%endblock%}

{% block left %}
<div>
  <h2>Choose a playlist to analyze:</h2>
  <ul id="playlist-list">
    {% for playlist in playlists %}
    <li data-id="{{ playlist.id }}" class="playlist-item{% if playlist.name == playlist_name %} selected{% endif %}">
      {{ playlist.name }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}

{% block right %}
<div>
  <p>Choose a playlist to analyze on the left, and generate a new playlist with the "Generate New Playlist" button.
  </p>

  <br>

  <h2>Generate a new playlist:</h2>
  <p>Click the button below to generate a new playlist based on the selected playlist on the left.</p>
  <form id="generate-form" action="/generate-from-playlist" method="post">
    <button id="generate-button" type="submit">Generate New Playlist</button>
  </form>

  <br>

  <h2>View your new playlist:</h2>
  <p id="playlist-desc">{{new_playlist_description}}</p>
  <form id="playlist-name-form" action="{{new_playlist_url}}">
    <button id="playlist-name-button" type="submit">{{new_playlist_name}}</button>
  </form>
</div>
{% endblock %}

{% block main %}
<!-- This script handles choosing a playlist -->
<script>
  document.querySelectorAll('.playlist-item').forEach(item => {
    item.addEventListener('click', () => {
      const playlistId = item.dataset.id;

      fetch('/select_playlist', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ playlist_id: playlistId })
      })
        .then(response => response.json())
        .then(data => {
          console.log('Playlist selected:', data);
          // You can redirect or update the UI here
          location.reload();
        });
    });
  });
</script>

<script type="text/javascript" src="/static/js/dynamic_buttons.js"></script>

{% endblock %}